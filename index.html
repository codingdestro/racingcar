<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        padding: 0;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        width: 100%;
        height: 50vh;
        font-family: sans-serif;
      }
      .layout button {
        width: 100px;
        height: 40px;
        border-radius: 0.4rem;
      }
      .layout {
        position: absolute;
        width: 100%;
        top: 512px;
        display: flex;
        justify-content: space-around;
      }
      .score {
        position: absolute;
        top: 50px;
        left: 50px;
        color: white;
        font-weight: 900;
        font-size: 20px;
      }
      .score span {
        font-size: 16 px;
      }
      .gameover {
        display: none;
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 80px;
        font-style: italic;
        font-family: "Ubuntu Mono";
      }
    </style>
    <title>Game Test</title>
  </head>
  <body>
    <canvas class="canva"></canvas>
    <div class="score">Score: <span>231</span></div>
    <div class="layout">
      <button>&leftarrow;</button>
      <button>&rightarrow;</button>
    </div>
    <div class="gameover">Game Over!</div>
  </body>
  <script src="enime.js" defer></script>
  <script defer>
    let canva = document.querySelector(".canva");
    W = 430;
    H = 512;

    let viechle = [
      ["./cars/audi.png", 100, 212],
      ["./cars/car.png", 100, 212],
      ["./cars/mini_truck.png", 100, 212],
      ["./cars/taxi.png",100,214]
    ];

    canva.width = W;
    canva.height = H;

    let ctx = canva.getContext("2d");
    let img = new Image();
    let background = new Image();
    let background2 = new Image();

    background.src = "background.png";
    background2.src = "background.png";
    img.src = "./cars/black_viper.png";

    let scoreDisplay = document.querySelector(".score span");
    let buttons = document.querySelectorAll(".layout button");
    buttons.forEach((ele, idx) => {
      ele.addEventListener("click", () => {
        console.log(buttons);
        if (buttons[idx].innerHTML == "←") {
          myCar.move("a");
        } else if (buttons[idx].innerHTML == "→") {
          myCar.move("d");
        }
      });
    });

    let score = 0;
    let gameOver = false;
    let gameFrames = 0;
    let straggerFrame = 1;
    let x = 0;
    let y = 300;
    let xoffset = 100;
    let yoffset = 214;
    let bgy = 00;
    let bgSpeed = 10;
    let lastRand = 0;
    let tmp = 0;
    const random = (min, max) => {
      return Math.floor(Math.random() * (max - min) + min);
    };
    let i = 50;

    function sprite() {
      ctx.clearRect(0, 0, window.innerWidth, H);
      if (gameFrames % straggerFrame == 0) {
        bgy += bgSpeed;
        if (tmp > i) {
          cars.push(new Car());
          tmp = 0;
          i = random(50, 100);
        }

        if (bgy > H - 12) {
          bgy = 0;
        }
        ctx.drawImage(background2, 0, 0, 430, 512, 0, bgy + 500, 430, 512);
        ctx.drawImage(background, 0, 0, 430, 512, 0, bgy, 430, 512);
        ctx.drawImage(background, 0, 0, 430, 512, 0, bgy - 500, 430, 512);
        myCar.draw();

        for (let i = 0; i < cars.length; i++) {
          cars[i].draw();
          if (cars[0].y > H + 10) {
            console.log("remove it");
            cars = cars.slice(1, cars.length);
            i--;
          }
        }

        tmp += 1;
      }
      gameFrames++;
      score++;
      scoreDisplay.innerHTML = score;
      if (gameOver) {
        document.querySelector(".gameover").style.display = "block";
        return;
      }
      requestAnimationFrame(sprite);
    }

    img.onload = () => {
      sprite();
    };
    window.addEventListener("click", () => {});
    xspeed = 10;
    window.addEventListener("keypress", (event) => {
      myCar.move(event.key);
    });

    window.addEventListener("keyup", (event) => {
      if (event.key == "Enter") {
        bgSpeed = 10;
        xspeed = 10;
      }
    });
  </script>
</html>
